#!/bin/bash
# This script was generated by JetBrains Junie

# Load environment variables from .env file
if [ -f .env ]; then
  export $(grep -v '^#' .env | xargs)
fi

# Function to get compose files (equivalent to get_compose_files in utils.js)
get_compose_files() {
  local compose_files="-f docker-compose.yml"

  if [ -f docker-compose.override.yml ]; then
    compose_files="$compose_files -f docker-compose.override.yml"
  fi

  if [ "$LOCAL_DB_TYPE" != "mysql" ]; then
    echo "$compose_files"
    return
  fi

  if [ "$LOCAL_PHP" != "7.2-fpm" ] && [ "$LOCAL_PHP" != "7.3-fpm" ]; then
    echo "$compose_files"
    return
  fi

  # PHP 7.2/7.3 in combination with MySQL 8.4 requires additional configuration
  if [ "$LOCAL_DB_VERSION" = "8.4" ]; then
    compose_files="$compose_files -f tools/local-env/old-php-mysql-84.override.yml"
  fi

  echo "$compose_files"
}

# Set XDEBUG environment variables if --coverage-html is passed
if [[ "$*" == *--coverage-html* ]]; then
  export LOCAL_PHP_XDEBUG=true
  export LOCAL_PHP_XDEBUG_MODE=coverage
fi

# Get compose files
COMPOSE_FILES=$(get_compose_files)

# Execute Docker compose command
docker compose $COMPOSE_FILES "$@"
