#!/bin/bash
# This script was generated by JetBrains Junie

# Load environment variables from .env file
if [ -f .env ]; then
  export $(grep -v '^#' .env | xargs)
fi

# Source the docker.sh script to get access to the Docker environment
source bin/docker.sh

# Use LOCAL_TEST_DB_NAME if set, otherwise default to 'wptest'
DB_NAME=${LOCAL_TEST_DB_NAME:-wptest}

echo "Resetting test database '$DB_NAME'..."

# Function to run MySQL commands in the Docker environment
run_mysql_command() {
  bin/docker.sh exec -i wp-db mysql -uroot -ppassword -e "$1"
}

# Drop the test database if it exists
echo "Dropping database '$DB_NAME' if it exists..."
run_mysql_command "DROP DATABASE IF EXISTS $DB_NAME;"

# Create the test database
echo "Creating database '$DB_NAME'..."
run_mysql_command "CREATE DATABASE $DB_NAME;"

# Grant privileges to the root user
echo "Granting privileges to root user..."
run_mysql_command "GRANT ALL PRIVILEGES ON $DB_NAME.* TO 'root'@'%';"
run_mysql_command "FLUSH PRIVILEGES;"

echo "Test database '$DB_NAME' has been reset successfully."
