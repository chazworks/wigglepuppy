#!/bin/bash
# This script was generated by Jetbrains Junie

# Load environment variables from .env file
if [ -f .env ]; then
  export $(grep -v '^#' .env | xargs)
fi

# Create wp-tests-config.php if it doesn't exist
if [ ! -f wp-tests-config.php ]; then
  echo "Creating wp-tests-config.php..."

  # Use LOCAL_TEST_DB_NAME if set, otherwise default to 'wptest'
  DB_NAME=${LOCAL_TEST_DB_NAME:-wptest}

  # Create wp-tests-config.php from wp-tests-config-sample.php
  sed -e "s/youremptytestdbnamehere/$DB_NAME/" \
      -e "s/yourusernamehere/root/" \
      -e "s/yourpasswordhere/password/" \
      -e "s/localhost/wp-db/" \
      -e "s/'WP_TESTS_DOMAIN', 'example.org'/'WP_TESTS_DOMAIN', '${LOCAL_WP_TESTS_DOMAIN:-example.org}'/" \
      wp-tests-config-sample.php > wp-tests-config.php

  # Add FS_METHOD to wp-tests-config.php
  echo "define( 'FS_METHOD', 'direct' );" >> wp-tests-config.php

  echo "wp-tests-config.php created successfully."
fi

# Run PHPUnit tests using Docker
$(dirname "$0")/docker.sh run --rm wp-php ./vendor/bin/phpunit "$@"
