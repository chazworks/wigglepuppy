# WordPress to WigglePuppy Batch Rebranding Script

_This document was generated by JetBrains Junie_

## Overview

This document describes the `batch-rebranding.php` script, which performs all non-rector regex replacements for the WordPress to WigglePuppy rebranding process in a single batch. The script respects all the requirements specified in `/docs/plans/rebranding.md`.

## Purpose

The batch rebranding script is designed to:

1. Process all files in the repository that need rebranding
2. Apply regex-based replacements of "WordPress" with "WigglePuppy"
3. Respect all caveats and requirements specified in the rebranding plan
4. Generate a manifest file of all changes made
5. Create a detailed log of the rebranding process

## Usage

To run the batch rebranding script:

```bash
php tools/rebranding/batch-rebranding.php
```

## Features

### 1. Comprehensive File Processing

The script processes files with the following extensions:
- Text files: txt, md, html, htm, xml, csv, json, svg
- Web files: php, js, css, scss, less
- Config files: yml, yaml, ini, config
- Other: sql, sh, bat

### 2. Respect for Rebranding Caveats

The script respects all caveats specified in the rebranding plan:

- **Copyright Notices and Author Attributions**: All copyright notices and author attributions remain unchanged
- **PHP Identifiers**: All PHP identifiers containing "wordpress" remain unchanged (variables, functions, classes, namespaces, constants)
- **Filenames and URLs**: Filenames and URLs containing "wordpress" remain unchanged
- **WordPress as an Organization**: References to WordPress as an organization remain unchanged
- **Casing Preservation**: When replacing "WordPress" with "WigglePuppy", the casing is preserved
- **Co-occurrence of Terms**: Lines containing both "wordpress" and "wigglepuppy" remain unchanged
- **Whitespace Preservation**: The type and amount of whitespace on a line remains unchanged
- **.gitignore Respect**: Files and directories specified in the .gitignore file are not processed
- **Minified Files**: Minified files are not processed
- **JavaScript Identifiers**: All JavaScript identifiers containing "wordpress" remain unchanged

### 3. Intelligent File Scanning

The script uses a non-recursive approach to scan directories, which is more memory-efficient for large repositories. It also:

- Respects .gitignore patterns
- Skips minified files (both by extension and by content analysis)
- Preserves original line endings (CR, LF, CRLF)

### 4. Detailed Logging and Manifest Generation

The script generates:

1. **Rebranding Log**: A detailed Markdown file showing all replacements made, including:
   - Total files processed
   - Total replacements made
   - Line-by-line before/after comparison

2. **Rebranding Manifest**: A JSON file containing structured data about all changes made, which can be used for:
   - Automated verification
   - Rollback if necessary
   - Integration with other tools

## Output Files

- **Log File**: `/docs/rebranding/batch-rebranding-log.md`
- **Manifest File**: `/docs/rebranding/rebranding-manifest.json`

## Implementation Details

### Skip Patterns

The script uses regular expressions to identify patterns that should not be replaced:

1. **Copyright and Author Attributions**:
   ```php
   '/copyright.*wordpress|author.*wordpress/i'
   ```

2. **PHP Identifiers**:
   ```php
   '/\$[a-zA-Z0-9_]*wordpress[a-zA-Z0-9_]*/i' // Variables
   '/function\s+[a-zA-Z0-9_]*wordpress[a-zA-Z0-9_]*|[a-zA-Z0-9_]*wordpress[a-zA-Z0-9_]*\s*\(/i' // Functions
   '/class\s+[a-zA-Z0-9_]*WordPress[a-zA-Z0-9_]*/i' // Classes
   '/namespace\s+[a-zA-Z0-9_\\\\]*WordPress[a-zA-Z0-9_\\\\]*/i' // Namespaces
   '/const\s+[a-zA-Z0-9_]*WORDPRESS[a-zA-Z0-9_]*/i' // Constants
   ```

3. **Filenames and URLs**:
   ```php
   '/[\'"][a-zA-Z0-9_\/\.\-]*wordpress[a-zA-Z0-9_\/\.\-]*[\'"]/i' // Filenames
   '/https?:\/\/[a-zA-Z0-9_\.\-]*wordpress[a-zA-Z0-9_\.\-]*/i' // URLs
   '/[\'"]\/wp-[a-zA-Z0-9_\/\.\-]*[\'"]/i' // WordPress paths
   ```

4. **WordPress as an Organization**:
   ```php
   '/wordpress\s+team|wordpress\s+foundation|wordpress\s+community|by\s+wordpress/i'
   '/visit\s+wordpress\.org|wordpress\.org\s+for/i'
   ```

5. **JavaScript Identifiers**:
   ```php
   '/\b[a-zA-Z0-9_]*wordpress[a-zA-Z0-9_]*\b\s*[:=]/i' // JS variables
   '/\b[a-zA-Z0-9_]*wordpress[a-zA-Z0-9_]*\b\s*\(/i' // JS functions
   '/@wordpress\/[a-zA-Z0-9_\-]*/i' // npm namespaces
   ```

6. **Co-occurrence of WordPress and WigglePuppy**:
   ```php
   '/.*wordpress.*wigglepuppy.*|.*wigglepuppy.*wordpress.*/i'
   ```

### Replacement Patterns

The script uses the following replacement patterns to preserve casing:

```php
$replacementPatterns = [
    '/\bWordPress\b/' => 'WigglePuppy',
    '/\bwordpress\b/' => 'wigglepuppy',
    '/\bWORDPRESS\b/' => 'WIGGLEPUPPY'
];
```

## Integration with Rector

This script handles all non-rector replacements. For PHP code that can be safely refactored using Rector, please refer to the custom Rector rules in `/tools/rebranding/rector/src/Rebranding/`.

## Troubleshooting

If you encounter issues during the rebranding process:

1. Check the log file at `/docs/rebranding/batch-rebranding-log.md` for details on what was changed
2. Review the manifest file at `/docs/rebranding/rebranding-manifest.json` for structured data about changes
3. For specific files that weren't properly rebranded, manually inspect them and apply changes if necessary
4. If significant issues are discovered, consider using the rollback plan outlined in the rebranding document
